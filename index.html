<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Oráculo Diario - Tu Carta Numerológica</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        body { font-family: 'Cinzel', serif; background-color: #1a1a1a; color: #e0e0e0; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; text-align: center; }
        .container { max-width: 800px; background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 40px; box-shadow: 0 0 30px rgba(255, 223, 186, 0.2); }
        h1 { font-size: 3em; color: #ffd700; margin-bottom: 10px; }
        p { font-size: 1.2em; line-height: 1.6; margin-bottom: 30px; }
        img.preview { max-width: 100%; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); margin-bottom: 40px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 1.1em; }
        input { width: 80%; padding: 12px; border-radius: 8px; border: 1px solid #555; background: #333; color: #fff; font-family: 'Cinzel', serif; font-size: 1em; }
        .cta-button { background: #ffd700; color: #1a1a1a; border: none; padding: 15px 30px; font-size: 1.5em; font-family: 'Cinzel', serif; font-weight: bold; border-radius: 10px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .cta-button:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        
        <div id="sales-section">
            <h1>Descubre el Mapa de Tu Alma</h1>
            <p>Recibe una Carta Numerológica personalizada...</p>
            <img class="preview" src="https://i.ibb.co/hL4PCf2/pergamino-portada-opt.jpg" alt="Ejemplo de Carta Numerológica">
            <div class="form-group">
                <label for="nombre">Tu Nombre Completo</label>
                <input type="text" id="nombre" placeholder="Escribe tu nombre aquí" required>
            </div>
             <div class="form-group">
                <label for="email">Tu Email (para recibir la carta)</label>
                <input type="email" id="email" placeholder="Escribe tu email aquí" required>
            </div>
            <div class="form-group">
                <label for="fecha">Tu Fecha de Nacimiento</label>
                <input type="date" id="fecha" required>
            </div>
            <button id="paymentButton" class="cta-button">Pide tu Carta por 25€</button>
        </div>

        <div id="thank-you-section" class="hidden">
            <h1>¡Gracias por tu confianza!</h1>
            <p>El Oráculo ha recibido tu petición. Tu pago ha sido procesado con éxito.</p>
            <p>Estamos tejiendo los hilos de tu destino. La recibirás en tu correo en las próximas horas.</p>
        </div>

    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const stripePaymentLink = "URL_DE_TU_LINK_DE_PAGO_DE_STRIPE";
        const n8nWebhookUrl = "URL_DE_TU_WEBHOOK_DE_N8N";

        const salesSection = document.getElementById("sales-section");
        const thankYouSection = document.getElementById("thank-you-section");

        // --- MANEJADOR DEL BOTÓN DE PAGO ---
        document.getElementById("paymentButton").addEventListener("click", function() {
            const nombre = document.getElementById("nombre").value;
            const fechaInput = document.getElementById("fecha").value;
            const email = document.getElementById("email").value;

            if (!nombre || !fechaInput || !email) {
                alert("Por favor, completa todos los campos.");
                return;
            }

            localStorage.setItem("numerology_data", JSON.stringify({ nombre, fecha: fechaInput, email }));
            
            // Pasamos el email a Stripe para pre-rellenar su campo de pago
            const finalStripeUrl = `${stripePaymentLink}?prefilled_email=${encodeURIComponent(email)}`;
            window.location.href = finalStripeUrl;
        });

        // --- LÓGICA DE LA PÁGINA DE GRACIAS ---
        window.addEventListener("load", function() {
            if (window.location.pathname === "/gracias") {
                salesSection.classList.add("hidden");
                thankYouSection.classList.remove("hidden");

                const storedData = localStorage.getItem("numerology_data");
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get('session_id');

                if (storedData && sessionId) {
                    const { nombre, fecha, email } = JSON.parse(storedData);
                    
                    const [year, month, day] = fecha.split('-');
                    const fechaFormateada = `${day}-${month}-${year}`;

                    const dataToSend = {
                        nombre: nombre,
                        fecha: fechaFormateada,
                        email: email,
                        stripe_session_id: sessionId
                    };

                    fetch(n8nWebhookUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dataToSend),
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Éxito - n8n ha recibido los datos:', data);
                        localStorage.removeItem("numerology_data");
                    })
                    .catch((error) => console.error('Error al enviar datos a n8n:', error));
                }
            }
        });
    </script>
</body>
</html>
