<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tirada de Cartas - El Oráculo Diario</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
</head>
<body>

    <!-- CABECERA FIJA CON INFO DE USUARIO -->
    <header class="header">
        <div class="logo">
            <h1>El Oráculo Diario</h1>
        </div>
        <div id="user-header-info">
            <!-- El contenido (botón de login o email de usuario) se inyectará aquí por auth.js -->
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL DE LA PÁGINA -->
    <main>
        <div class="container">
            <div class="card">
                <h1>El Oráculo Diario</h1>
                <p>Concentra tu mente en una pregunta y haz clic en el botón para revelar las cartas.</p>
                <button id="reveal-btn" class="cta-button">Revelar Cartas</button>
            </div>
        </div>
    </main>

    <!-- MODAL DE AUTENTICACIÓN (LOGIN / REGISTRO) -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <span class="close-modal">&times;</span>
            <div class="auth-tabs">
                <button class="tab-button active" id="loginTab">Iniciar Sesión</button>
                <button class="tab-button" id="signupTab">Registrarse</button>
            </div>
            <div id="login-content" class="tab-content active">
                <form id="login-form" class="auth-form">
                    <input type="email" name="email" placeholder="Correo Electrónico" required>
                    <div class="error-message" id="login-error"></div>
                    <input type="password" name="password" placeholder="Contraseña" required>
                    <button type="submit">Entrar</button>
                </form>
            </div>
            <div id="signup-content" class="tab-content">
                <form id="signup-form" class="auth-form">
                    <input type="email" name="email" placeholder="Correo Electrónico" required>
                    <div class="error-message" id="signup-error"></div>
                    <input type="password" name="password" placeholder="Crear Contraseña" required>
                    <button type="submit">Crear Cuenta</button>
                </form>
            </div>
        </div>
    </div>

    <!-- SCRIPTS (El orden es importante) -->
    <!-- 1. Librería de Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    
    <!-- 2. Tu cliente de Supabase (recuerda configurarlo) -->
    <script src="../supabase-client.js"></script>
    
    <!-- 3. Lógica de autenticación (header, modal, login, etc.) -->
    <script src="../js/auth.js"></script>
    
    <!-- 4. Tu script existente de partículas -->
    <script src="../js/particles.js"></script>
    
    <!-- 5. Lógica específica para esta página (el botón de revelar) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const revealBtn = document.getElementById('reveal-btn');

            if (revealBtn) {
                revealBtn.addEventListener('click', async () => {
                    // 1. Verificar si el usuario está autenticado
                    const { data: { session } } = await window.supabase.auth.getSession();

                    if (session) {
                        // 2. Si está autenticado, redirigir a la página de resultados
                        console.log('Usuario autenticado. Redirigiendo a resultado.html...');
                        window.location.href = 'resultado.html';
                    } else {
                        // 3. Si no lo está, mostrar el modal de autenticación
                        console.log('Usuario no autenticado. Mostrando modal de login...');
                        document.getElementById('authModal').style.display = 'flex';
                    }
                });
            }
        });
    </script>
</body>
</html>
